# This file was generated with the help of GPT-3
# https://help.openai.com/en/articles/6825453-chatgpt-release-notes
# 
# OpenAI. (2023). ChatGPT (May 24 version) [Large language model]. 
# 	https://chat.openai.com/chat

version: '3'
networks:
  web-test-env:
    ipam:
      config:
        - subnet: 172.20.0.0/16
services:
  php-apache:
    # Builds the custom php:apache image using the specified Dockerfile
    build:
      context: .
      dockerfile: Dockerfile-php-apache
    # "image" should have a custom name since the accompanying Dockerfile is pulling the
    # container we want from the public registry and building our changes locally.
    # If the image name isn't unique, it will overwrite the default container image
    # named php:apache if we have pulled it previously and it exists locally.
    # Additionally if the Dockerfile fails to build our custom image, this line won't attempt to 
    # search and pull whatever image name we write for "image:" from the public registry.
    image: php:custom-local-image
    container_name: apache-php-testing-custom-image
    networks:
      web-test-env:
        ipv4_address: 172.20.0.2
    ports:
      - 80:80
    volumes:
      - ./www/html:/var/www/html:ro
      - ./php:/usr/local/etc/php:ro

  mysql:
    # Builds the custom mysql image using the specified Dockerfile
    # This allows us to run the init.sql script to execute mysql commands
    build:
      context: .
      dockerfile: Dockerfile-mysql
    image: mysql:custom-local-image
    container_name: mysql-testing-custom-image
    networks:
      web-test-env:
        ipv4_address: 172.20.0.3
    ports:
      - 3306:3306
    # Any other mysql configurations should be handled by the special init.sql file
    environment:
      - MYSQL_ROOT_PASSWORD=new_password2
